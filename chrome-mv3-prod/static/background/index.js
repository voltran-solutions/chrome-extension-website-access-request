var e,r;"function"==typeof(e=globalThis.define)&&(r=e,e=null),function(r,t,o,s,n){var a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},i="function"==typeof a[s]&&a[s],l=i.cache||{},c="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function u(e,t){if(!l[e]){if(!r[e]){var o="function"==typeof a[s]&&a[s];if(!t&&o)return o(e,!0);if(i)return i(e,!0);if(c&&"string"==typeof e)return c(e);var n=Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}f.resolve=function(t){var o=r[e][1][t];return null!=o?o:t},f.cache={};var d=l[e]=new u.Module(e);r[e][0].call(d.exports,f,d,d.exports,this)}return l[e].exports;function f(e){var r=f.resolve(e);return!1===r?{}:u(r)}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=r,u.cache=l,u.parent=i,u.register=function(e,t){r[e]=[function(e,r){r.exports=t},{}]},Object.defineProperty(u,"root",{get:function(){return a[s]}}),a[s]=u;for(var d=0;d<t.length;d++)u(t[d]);if(o){var f=u(o);"object"==typeof exports&&"undefined"!=typeof module?module.exports=f:"function"==typeof e&&e.amd?e(function(){return f}):n&&(this[n]=f)}}({kgW6q:[function(e,r,t){e("../../../background")},{"../../../background":"8VaxY"}],"8VaxY":[function(e,r,t){var o=e("./utils/googleAppsScript");chrome.runtime.onMessage.addListener((e,r,t)=>{if("testManagedSchema"===e.action)return(0,o.getEnterpriseConfig)().then(e=>{e?t({success:!0,config:e}):(0,o.loadConfiguration)().then(e=>{t({success:!1,error:"No managed schema found in Admin Console",localConfig:{url:e}})}).catch(e=>{t({success:!1,error:`Failed to load any configuration: ${e.message}`})})}).catch(e=>{t({success:!1,error:`Error testing managed schema: ${e.message}`})}),!0})},{"./utils/googleAppsScript":"1FTL5"}],"1FTL5":[function(e,r,t){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(t),o.export(t,"getUserInfo",()=>s),o.export(t,"getEnterpriseConfig",()=>n),o.export(t,"loadConfiguration",()=>a),o.export(t,"fetchSheetData",()=>i),o.export(t,"validatePinWithGoogleScript",()=>l),o.export(t,"logAccessRequest",()=>c),o.export(t,"setCooldown",()=>u),o.export(t,"getRemainingCooldown",()=>d),o.export(t,"validatePin",()=>f),o.export(t,"sendAccessRequest",()=>p);let s=async()=>new Promise(e=>{if("undefined"==typeof chrome||!chrome.identity){e({email:"Unknown",id:"Unknown"});return}try{chrome.identity.getProfileUserInfo({accountStatus:chrome.identity.AccountStatus.ANY},r=>{if(chrome.runtime.lastError){console.warn("Failed to get user info:",chrome.runtime.lastError.message),e({email:"Unknown",id:"Unknown"});return}e({email:r.email||"Unknown",id:r.id||"Unknown"})})}catch(r){console.error("Error fetching user info:",r),e({email:"Error",id:"Error"})}}),n=async()=>new Promise(e=>{if("undefined"==typeof chrome||!chrome.storage||!chrome.storage.managed){console.warn("Managed storage API not available"),e(null);return}try{chrome.storage.managed.get(["PinValidationWebAppUrl","AccessRequestSheetWebAppUrl"],r=>{if(chrome.runtime.lastError){console.warn("Failed to get managed config:",chrome.runtime.lastError.message),e(null);return}let t={PinValidationWebAppUrl:r.PinValidationWebAppUrl||"",AccessRequestSheetWebAppUrl:r.AccessRequestSheetWebAppUrl||""};if(console.log("Loaded enterprise config:",t),!t.PinValidationWebAppUrl||!t.AccessRequestSheetWebAppUrl){console.warn("Enterprise configuration missing required properties"),e(null);return}e(t)})}catch(r){console.error("Error fetching managed config:",r),e(null)}}),a=async()=>{try{let e=await n();if(e?.AccessRequestSheetWebAppUrl)return console.log("Using managed configuration from Google Admin Console"),e.AccessRequestSheetWebAppUrl;console.log("Falling back to local configuration file");let r=chrome.runtime.getURL("config.json"),t=await fetch(r);if(!t.ok)throw Error(`Failed to load config.json: ${t.status} ${t.statusText}`);let o=await t.json();if(!o.AccessRequestSheetWebAppUrl?.Value)throw Error("AccessRequestSheetWebAppUrl not found in config.json");return o.AccessRequestSheetWebAppUrl.Value}catch(e){throw console.error("Configuration loading error:",e),Error(`Failed to load configuration: ${e.message}`)}},i=async e=>{try{let r;let t=await a(),o=new URL(t);o.searchParams.append("userEmail",e),o.searchParams.append("action","getData"),console.log("Fetching data from:",o.toString());let s=await fetch(o.toString(),{method:"GET",headers:{"Content-Type":"application/json"},redirect:"follow"});if(!s.ok)throw Error(`HTTP ${s.status}: ${s.statusText}`);let n=await s.text();if(console.log("Raw response:",n),!n||""===n.trim())throw Error("Empty response from Google Apps Script");try{r=JSON.parse(n)}catch(e){throw console.error("Failed to parse response:",e),console.error("Response text was:",n),Error("Invalid JSON response from Google Apps Script")}if(console.log("Parsed response data:",r),r.error)throw Error(r.error);if(r.table&&r.table.cols)throw console.warn("Received old Google Sheets JSON format, but expected Google Apps Script format"),Error("The Google Apps Script is returning Google Sheets JSON format instead of processed data. Please check the script configuration.");let i=[];if(Array.isArray(r))i=r;else if(r.data&&Array.isArray(r.data))i=r.data;else if(r.rows&&Array.isArray(r.rows))i=r.rows;else if(r.result&&Array.isArray(r.result))i=r.result;else throw console.error("Unexpected data structure:",r),Error("Invalid data format: expected array of rows or object with array property");console.log(`Processing ${i.length} rows from Google Apps Script`);let l=i.map((e,r)=>(console.log(`Processing row ${r}:`,e),{timeStamp:e.Timestamp||e.timeStamp||e.timestamp||e["Date/Time"]||e.Date||"",userEmail:e["User Email"]||e.userEmail||e.email||e.Email||"",websiteTitle:e.Title||e.websiteTitle||e.title||e["Website Title"]||"",websiteURL:e.URL||e.websiteURL||e.url||e["Website URL"]||"",pinNumber:e["PIN Number"]||e.pinNumber||e.pin||e.PIN||"",pinStatus:"",formatType:e["Media Type"]||e.formatType||e.format||e["Format Type"]||e.Type||"",requestStatus:e["Request Status"]||e.requestStatus||e.approval||e["Approval Status"]||e.Status||"",accessURL:e["Access Link"]||e.accessURL||e.downloadUrl||e["Access URL"]||e["Download Link"]||e.Link||e.Access||e.Download||""}));return console.log(`Successfully transformed ${l.length} rows for user: ${e}`),l}catch(e){throw console.error("Error fetching sheet data:",e),Error(`Failed to fetch data: ${e.message}`)}},l=async(e,r)=>{try{let t,o;if(r)t=r;else{let e=await n();t=e.PinValidationWebAppUrl}let s=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pin:e}),redirect:"follow"});if(!s.ok)throw Error(`HTTP ${s.status}: ${s.statusText}`);let a=await s.text();try{o=JSON.parse(a)}catch{return{status:"error",message:"Invalid response format from validation service"}}if("success"===o.status)return{status:"success",message:o.message||"PIN is valid"};if("error"!==o.status)return{status:"error",message:`Unexpected validation response: ${o.status}`};{let e=o.message||"PIN validation failed";if(e.includes("Internal server error")||e.includes("server error"))return{status:"error",message:e};return{status:"failure",message:e}}}catch(e){return{status:"error",message:`Validation service error: ${e.message}`}}},c=async(e,r,t,o)=>{try{let s=await n(),a={url:e,title:r,timestamp:new Date().toISOString(),userEmail:o.email,userId:o.id,pin:t};return await fetch(s.AccessRequestSheetWebAppUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a),mode:"no-cors",redirect:"follow"}),{status:"success",message:"Access request logged successfully"}}catch(e){return{status:"error",message:`Logging service error: ${e.message}`}}},u=async(e=3e4)=>{let r=new Date().getTime();"undefined"!=typeof chrome&&chrome.storage?.local?await chrome.storage.local.set({lastSubmissionTime:r,cooldownDuration:e}):(localStorage.setItem("lastSubmissionTime",r.toString()),localStorage.setItem("cooldownDuration",e.toString()))},d=async()=>new Promise(e=>{if("undefined"!=typeof chrome&&chrome.storage?.local)chrome.storage.local.get(["lastSubmissionTime","cooldownDuration"],r=>{let t=r.lastSubmissionTime||0,o=r.cooldownDuration||3e4,s=new Date().getTime();e(Math.max(0,o-(s-t)))});else{let r=parseInt(localStorage.getItem("lastSubmissionTime")||"0"),t=parseInt(localStorage.getItem("cooldownDuration")||"30000"),o=new Date().getTime();e(Math.max(0,t-(o-r)))}}),f=async e=>{try{let r=await n();if(!r?.PinValidationWebAppUrl)throw console.error("Error: PinValidationWebAppUrl not configured in Admin Console"),Error("PIN validation URL not available");let t=r.PinValidationWebAppUrl;return console.log("Validating PIN using URL from Admin Console:",t),await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pin:e}),mode:"no-cors",redirect:"follow"}),console.log("PIN validation request sent successfully"),!0}catch(e){throw console.error("Error validating PIN:",e),Error(`PIN validation failed: ${e instanceof Error?e.message:"Unknown error"}`)}},p=async(e,r,t)=>{try{let o=await n();if(!o?.AccessRequestSheetWebAppUrl)throw console.error("Error: AccessRequestSheetWebAppUrl not configured in Admin Console"),Error("Access request URL not available");let s=o.AccessRequestSheetWebAppUrl,a={url:e,timestamp:new Date().toISOString(),userEmail:t.email,userId:t.id,pin:r};console.log("Sending access request using URL from Admin Console:",s),await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a),mode:"no-cors",redirect:"follow"});let i=new Date().getTime();return"undefined"!=typeof chrome&&chrome.storage?.local?chrome.storage.local.set({lastSubmissionTime:i},()=>{console.log("Last submission time saved.")}):localStorage.setItem("lastSubmissionTime",i.toString()),console.log("Access request sent successfully"),!0}catch(e){throw console.error("Error sending access request:",e),Error(`Access request failed: ${e instanceof Error?e.message:"Unknown error"}`)}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],f6DG4:[function(e,r,t){t.interopDefault=function(e){return e&&e.__esModule?e:{default:e}},t.defineInteropFlag=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.exportAll=function(e,r){return Object.keys(e).forEach(function(t){"default"===t||"__esModule"===t||r.hasOwnProperty(t)||Object.defineProperty(r,t,{enumerable:!0,get:function(){return e[t]}})}),r},t.export=function(e,r,t){Object.defineProperty(e,r,{enumerable:!0,get:t})}},{}]},["kgW6q"],"kgW6q","parcelRequireacb5"),globalThis.define=r;